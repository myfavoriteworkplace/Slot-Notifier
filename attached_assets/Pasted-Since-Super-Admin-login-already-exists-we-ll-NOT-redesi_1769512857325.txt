Since Super Admin login already exists, weâ€™ll NOT redesign it, only verify + harden it, and then focus on implementing Doctor login cleanly with a shared Clinic/Doctor flow.
Below is a clear, practical, step-by-step implementation plan, followed by very detailed Replit prompts (batch-wise).

ğŸ” FINAL AUTH DESIGN (CONFIRMED)
Login Page	Who Uses It	Status
Super Admin Login	App owner	âœ… Already exists â†’ verify & harden only
Clinic / Doctor Login	Clinic admins + Doctors	ğŸ†• Implement
PART 1: SIMPLE HIGH-LEVEL STEPS (READ THIS FIRST)
Step 1ï¸âƒ£ â€“ Cross-check Super Admin flow
Ensure role isolation
Ensure super admin cannot login via shared login
Ensure route guards exist
ğŸ‘‰ Only fix if missing
Step 2ï¸âƒ£ â€“ Extend user model for Doctors
Doctors become first-class users
Single users table with roles
Step 3ï¸âƒ£ â€“ Doctor creation flow
Super admin OR clinic admin can add doctor
Doctor created as INVITED
Email invite sent with token
Step 4ï¸âƒ£ â€“ Shared Clinic/Doctor login
Email OR username
Same login page
Backend decides role
Step 5ï¸âƒ£ â€“ Doctor dashboard & permissions
Doctor sees assigned patients
Can add diagnosis & prescription
Read-only clinic info
Step 6ï¸âƒ£ â€“ Route guards & security
Enforce role-based access
Prevent privilege escalation
PART 2: DATA MODEL (VERY IMPORTANT)
users table
id
email
username (nullable)
password_hash
role (SUPER_ADMIN | CLINIC_ADMIN | DOCTOR)
status (INVITED | ACTIVE | SUSPENDED)
created_by (admin id)
doctor_clinics
doctor_id
clinic_id
appointments / bookings
id
clinic_id
doctor_id
patient_id
slot_id
PART 3: BATCH-BY-BATCH REPLIT PROMPTS (DETAILED)
ğŸ”¹ BATCH 0: SUPER ADMIN FLOW â€“ VERIFY ONLY
ğŸ¯ Goal
Do nothing unless broken.
ğŸ“Œ Replit Prompt
Verify existing Super Admin authentication.

Checklist:
1. Confirm Super Admin has role = SUPER_ADMIN.
2. Ensure Super Admin cannot login via /api/auth/login.
3. Ensure Super Admin login endpoint is isolated.
4. Confirm route guards prevent non-super-admin access.
5. If any item is missing, implement it.
Otherwise, do NOT change existing logic.
ğŸ”¹ BATCH 1: USER & ROLE PREPARATION
ğŸ¯ Goal
Prepare system for doctors.
ğŸ“Œ Replit Prompt
Prepare user model for Doctor role.

Tasks:
1. Add role DOCTOR to user roles enum.
2. Add status field if not present (INVITED, ACTIVE).
3. Ensure username is optional and unique.
4. Add created_by reference.
5. Do NOT break existing clinic admin users.
ğŸ”¹ BATCH 2: DOCTOR CREATION FLOW
ğŸ¯ Goal
Admins can add doctors safely.
ğŸ“Œ Replit Prompt
Implement doctor creation flow.

Requirements:
1. Super Admin and Clinic Admin can create doctors.
2. Doctors must be associated with one or more clinics.
3. Create doctor user with:
   - role = DOCTOR
   - status = INVITED
   - no password initially
4. Save clinic-doctor mapping.
5. Prevent duplicate emails.
ğŸ”¹ BATCH 3: EMAIL INVITE + PASSWORD SETUP
ğŸ¯ Goal
Secure onboarding.
ğŸ“Œ Replit Prompt
Implement doctor invitation flow.

Requirements:
1. Generate single-use invite token (expires in 24h).
2. Email invite with secure link:
   /activate-account?token=XXX
3. Activation page allows:
   - Set password
   - Set username (optional)
4. Activate account only once.
5. Mark user status = ACTIVE.
ğŸ”¹ BATCH 4: SHARED LOGIN (CLINIC + DOCTOR)
ğŸ¯ Goal
One login, two roles.
ğŸ“Œ Replit Prompt
Implement shared login endpoint.

Endpoint: POST /api/auth/login

Rules:
1. Accept identifier (email OR username).
2. Allow roles:
   - CLINIC_ADMIN
   - DOCTOR
3. Reject SUPER_ADMIN logins.
4. Reject status != ACTIVE.
5. Return:
   - userId
   - role
   - associated clinic IDs
ğŸ”¹ BATCH 5: FRONTEND LOGIN + REDIRECT
ğŸ¯ Goal
Smooth UX.
ğŸ“Œ Replit Prompt
Implement frontend login redirect logic.

Rules:
1. After login:
   - CLINIC_ADMIN â†’ /clinic/dashboard
   - DOCTOR â†’ /doctor/dashboard
2. Persist auth state.
3. Show role-based navigation.
4. Hide admin-only options from doctors.
ğŸ”¹ BATCH 6: DOCTOR DASHBOARD (CORE FEATURE)
ğŸ¯ Goal
Doctors do real work here.
ğŸ“Œ Replit Prompt
Create Doctor Dashboard.

Features:
1. List assigned patients grouped by clinic.
2. View appointment details.
3. Add diagnosis notes.
4. Add prescription entries.
5. Doctors cannot:
   - Edit clinic
   - Edit other doctors
   - Access admin dashboards
ğŸ”¹ BATCH 7: ACCESS CONTROL (CRITICAL)
ğŸ¯ Goal
Prevent data leaks.
ğŸ“Œ Replit Prompt
Implement strict role-based access control.

Rules:
1. Doctors can only access:
   - their assigned clinics
   - their assigned patients
2. Clinic admins cannot access:
   - doctor-only dashboards
3. Super admin bypasses all restrictions.
4. Add backend guards for every route.
ğŸ”¹ BATCH 8: AUDIT & SAFETY (OPTIONAL BUT STRONG)
ğŸ¯ Goal
Production-ready system.
ğŸ“Œ Replit Prompt
Add audit logging.

Track:
1. Doctor login/logout
2. Prescription creation
3. Diagnosis updates
4. Admin doctor creation
Store:
- actor_id
- action
- timestamp
- clinic_id
âœ… WHY THIS DESIGN WILL SCALE
âœ” Clean separation
âœ” No duplicate users
âœ” Email-based identity
âœ” Secure onboarding
âœ” Easy to add mobile app later
âœ” Works for multi-clinic doctors
WHAT YOU SHOULD DO NEXT
ğŸ‘‰ Copy Batch 0 to Replit first
ğŸ‘‰ Then run Batch 1 â†’ Batch 4
ğŸ‘‰ Stop and test
ğŸ‘‰ Continue with dashboards
If you want, I can next:

Write exact SQL migrations
Create Angular route guards
Design doctor dashboard UI
Add 2FA only for super admin
Just say the word ğŸš€




ChatGPT can make mistakes. Check important info. See Cookie Preferences.
