This is NOT a mystery 401. Itâ€™s a classic production auth + cookies + route-mount issue.
Iâ€™ll break it down cleanly and then give you exact fixes.
ğŸ”´ WHAT IS ACTUALLY FAILING (FACTS FROM LOG)
âŒ These endpoints fail:
GET  /api/auth/user        â†’ 404
GET  /api/clinic/me        â†’ 404
GET  /api/admin/logs/status â†’ 401
POST /api/clinics          â†’ 401
PATCH /api/clinics/:id/... â†’ 401
âœ… These work:
POST /api/auth/admin/login â†’ 200 (SESSION SAVED)
GET  /api/health*          â†’ 200
GET  /api/slots, clinics   â†’ 200
ğŸ§  ROOT CAUSE (VERY CLEAR)
You have TWO DIFFERENT PROBLEMS happening at the same time:
ğŸ§¨ PROBLEM 1 â€” 404 API route not matched
Example:
[STATIC] API route not matched: GET /api/auth/user
Meaning (IMPORTANT):
ğŸ‘‰ That route is not registered at all in the running server
This is NOT auth
This is NOT cookies
This is NOT CORS
It literally means:
app.get("/api/auth/user") does not exist in production
Why?
Because you mounted only some routers, not all.
Example (likely):
app.use("/api/auth", adminAuthRouter);
// âŒ userAuthRouter never mounted
ğŸ§¨ PROBLEM 2 â€” 401 Cookie: missing
Example:
[AUTH-FAILURE] 401 Unauthorized
Cookie: missing
Origin: https://book-my-slot-client.onrender.com
Meaning:
ğŸ‘‰ Your browser is NOT sending session cookies to backend
This is 100% expected in production unless configured explicitly.
âœ… FIX 1 â€” REGISTER ALL AUTH ROUTES (404 FIX)
In your main server file (index.ts or server.ts)
You MUST have all routers mounted:
import adminAuthRouter from "./routes/auth.admin";
import userAuthRouter from "./routes/auth.user";
import clinicRouter from "./routes/clinic";
import adminRouter from "./routes/admin";

app.use("/api/auth", adminAuthRouter);
app.use("/api/auth", userAuthRouter);   // âœ… THIS WAS MISSING
app.use("/api/clinic", clinicRouter);   // ensures /api/clinic/me
app.use("/api/admin", adminRouter);     // ensures admin routes
Verify after deploy:
GET /api/auth/user   â†’ NOT 404 anymore
GET /api/clinic/me  â†’ NOT 404 anymore
âœ… FIX 2 â€” SESSION COOKIE NOT SENT (401 FIX)
This is the main production issue.
ğŸ”´ CURRENT BEHAVIOR (From Logs)
admin login successful, session saved
BUT later:
Cookie: missing
adminLoggedIn: undefined
That means:
Browser never sent the session cookie back
âœ… REQUIRED CHANGES (MANDATORY)
1ï¸âƒ£ Express Session config (PRODUCTION SAFE)
app.set("trust proxy", 1); // ğŸ”¥ REQUIRED ON RENDER

app.use(
  session({
    name: "book-my-slot.sid",
    secret: process.env.SESSION_SECRET!,
    resave: false,
    saveUninitialized: false,
    proxy: true,
    cookie: {
      httpOnly: true,
      secure: true,        // ğŸ”¥ REQUIRED for HTTPS
      sameSite: "none",    // ğŸ”¥ REQUIRED for cross-site
      maxAge: 1000 * 60 * 60 * 24
    }
  })
);
2ï¸âƒ£ CORS CONFIG (ABSOLUTELY REQUIRED)
app.use(
  cors({
    origin: "https://book-my-slot-client.onrender.com",
    credentials: true
  })
);
âš ï¸ NO *
âš ï¸ NO array unless necessary
3ï¸âƒ£ FRONTEND REQUESTS (CRITICAL)
Every authenticated request MUST include:
âœ… Fetch
fetch("/api/admin/logs/status", {
  credentials: "include"
});
âœ… Axios
axios.get("/api/admin/logs/status", {
  withCredentials: true
});
If this is missing â†’ cookies are dropped silently
âœ… FIX 3 â€” AUTH GUARD IS WORKING (GOOD NEWS)
This log proves auth logic is correct:
adminLoggedIn: undefined
adminEmail: undefined
Cookie: missing
ğŸ‘‰ Your middleware is protecting correctly
ğŸ‘‰ The issue is transport, not logic
ğŸ§ª HOW TO VERIFY (10 seconds)
After redeploy:
Open DevTools â†’ Network
Login as admin
Check response headers:
Set-Cookie: book-my-slot.sid=...
Call protected API
Check request headers:
Cookie: book-my-slot.sid=...
If cookie is present â†’ âœ… FIXED
ğŸ¯ FINAL SUMMARY
Issue	Status
Routes missing	âŒ needs mounting
Session created	âœ… working
Cookie sent	âŒ missing
CORS config	âŒ incomplete
Auth logic	âœ… correct
ğŸ† YOU ARE VERY CLOSE
Your backend is now:
correctly deployed
correctly compiled
correctly protecting routes
This is final-mile production auth plumbing, nothing more.
If you want next, I can:
Harden auth for JWT + session hybrid
Make admin & clinic auth separate
Add refresh-safe login persistence
Fix /api/auth/user semantics cleanly
Just tell me ğŸ‘